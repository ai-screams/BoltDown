@import './styles/tokens.css';
@import './styles/codeblock.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

/* BoltDown Custom Styles */

@layer base {
  /* Font Faces */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap');

  /* Dark Mode */
  .dark {
    color-scheme: dark;
  }

  /* Base Styles */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html,
  body,
  #root {
    height: 100%;
    overflow: hidden;
  }

  body {
    font-family: var(--p-font-sans);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  code,
  pre {
    font-family: var(--p-font-mono);
  }
}

/* Prose Styling (Markdown Preview) */
@layer components {
  .prose {
    @apply text-gray-900 dark:text-gray-100;
  }

  .prose h1 {
    @apply mb-4 text-4xl font-bold leading-tight tracking-tight text-gray-900 dark:text-white;
  }

  .prose h2 {
    @apply mb-3 mt-8 text-3xl font-bold leading-tight text-gray-900 dark:text-white;
  }

  .prose h3 {
    @apply mb-2 mt-6 text-2xl font-semibold leading-snug text-gray-900 dark:text-white;
  }

  .prose p {
    @apply mb-4 leading-relaxed;
  }

  .prose code {
    @apply rounded bg-gray-100 px-1.5 py-0.5 text-sm dark:bg-gray-800;
  }

  .prose pre {
    @apply mb-4 overflow-x-auto rounded-lg bg-gray-100 p-4 dark:bg-gray-800;
  }

  .prose a {
    @apply text-deep-blue underline hover:text-electric-dark dark:text-electric-yellow dark:hover:text-yellow-300;
  }

  .prose blockquote {
    @apply border-l-4 border-electric-yellow pl-4 italic text-gray-600 dark:text-gray-400;
  }
}

/* Prism.js Syntax Highlighting */
@layer components {
  .prose pre {
    @apply relative;
  }

  .prose pre code {
    @apply bg-transparent p-0;
    font-size: var(--preview-code-font-size, 14px);
  }

  /* Language badge in preview code blocks */
  .prose .preview-lang-badge {
    position: absolute;
    bottom: 6px;
    right: 10px;
    font-size: 0.75em;
    font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
    color: rgb(var(--c-code-block-badge) / 0.7);
    text-transform: lowercase;
    letter-spacing: 0.03em;
    pointer-events: none;
    user-select: none;
  }

  /* Token colors (Tomorrow Night inspired) */
  .token.comment,
  .token.prolog,
  .token.doctype,
  .token.cdata {
    color: rgb(var(--c-prism-comment) / 1);
  }
  .token.punctuation {
    color: rgb(var(--c-prism-punctuation) / 1);
  }
  .token.property,
  .token.tag,
  .token.boolean,
  .token.number,
  .token.constant,
  .token.symbol,
  .token.deleted {
    color: rgb(var(--c-prism-property) / 1);
  }
  .token.selector,
  .token.attr-name,
  .token.string,
  .token.char,
  .token.builtin,
  .token.inserted {
    color: rgb(var(--c-prism-selector) / 1);
  }
  .token.operator,
  .token.entity,
  .token.url {
    color: rgb(var(--c-prism-operator) / 1);
  }
  .token.atrule,
  .token.attr-value,
  .token.keyword {
    color: rgb(var(--c-prism-keyword) / 1);
  }
  .token.function,
  .token.class-name {
    color: rgb(var(--c-prism-function) / 1);
  }
  .token.regex,
  .token.important,
  .token.variable {
    color: rgb(var(--c-prism-regex) / 1);
  }
}

/* Prose extras */
@layer components {
  .prose ul {
    @apply mb-4 list-disc pl-6;
  }

  .prose ol {
    @apply mb-4 list-decimal pl-6;
  }

  .prose li {
    @apply mb-1;
  }

  .prose hr {
    @apply my-6 border-gray-200 dark:border-gray-700;
  }

  .prose table {
    @apply mb-4 w-full border-collapse;
  }

  .prose th {
    @apply border border-gray-300 bg-gray-50 px-3 py-2 text-left font-semibold dark:border-gray-600 dark:bg-gray-800;
  }

  .prose td {
    @apply border border-gray-300 px-3 py-2 dark:border-gray-600;
  }

  .prose img {
    @apply my-4 max-w-full rounded;
  }

  .katex-block {
    @apply my-4 overflow-x-auto text-center;
  }

  .mermaid-rendered {
    @apply my-4 flex justify-center;
  }

  .mermaid-rendered svg {
    @apply max-w-full;
  }

  .prose strong {
    @apply font-bold;
  }

  .prose em {
    @apply italic;
  }

  /* TOC navigation */
  .markdown-toc {
    @apply my-4 rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800;
  }
  .markdown-toc .toc-item {
    @apply py-0.5;
  }
  .markdown-toc .toc-item a {
    @apply text-sm text-blue-600 no-underline hover:text-blue-800 hover:underline dark:text-blue-400 dark:hover:text-blue-300;
  }
}

/* Custom Scrollbar */
@layer base {
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: rgb(var(--c-scrollbar-thumb) / 1);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgb(var(--c-scrollbar-thumb-hover) / 1);
  }
}

/* Find & Replace match highlighting */
@layer components {
  .cm-searchMatch {
    background-color: var(--c-search-match-bg);
    border-radius: 2px;
  }
  .cm-searchMatch-selected {
    background-color: var(--c-search-match-selected-bg);
    border-radius: 2px;
    box-shadow:
      0 0 0 1px var(--c-search-match-selected-ring),
      0 0 0 3px var(--c-search-match-selected-glow);
  }
}

/* Focus Mode line dimming */
@layer components {
  .cm-focus-dimmed {
    opacity: 0.3;
    transition: opacity 200ms ease-out;
  }
  .cm-focus-context {
    opacity: 0.6;
    transition: opacity 200ms ease-out;
  }
}

/* CodeMirror full-height fix */
@layer components {
  .cm-editor {
    height: 100% !important;
  }

  .cm-scroller {
    overflow: auto !important;
    overscroll-behavior: contain;
  }
}

/* Animations */
@layer utilities {
  .animate-bolt {
    animation: bolt 0.3s ease-in-out;
  }

  @keyframes bolt {
    0%,
    100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-4px);
    }
  }

  .animate-dropdown {
    animation: dropdown 0.15s ease-out;
  }

  @keyframes dropdown {
    from {
      opacity: 0;
      transform: translateY(-4px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Zen Mode transitions */
  .zen-slide-up {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition:
      max-height 250ms cubic-bezier(0.4, 0, 0.2, 1),
      opacity 250ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .zen-slide-down {
    max-height: 200px;
    opacity: 1;
    overflow: visible;
    transition:
      max-height 250ms cubic-bezier(0.4, 0, 0.2, 1),
      opacity 250ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .zen-footer-dim {
    opacity: 0.4;
    transition: opacity 250ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .zen-footer-dim:hover {
    opacity: 1;
  }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* Print Styles */
@media print {
  header,
  footer,
  .cm-editor,
  .cm-gutters {
    display: none !important;
  }

  main {
    display: block !important;
  }

  .prose {
    max-width: 100% !important;
    padding: 0 !important;
  }
}
